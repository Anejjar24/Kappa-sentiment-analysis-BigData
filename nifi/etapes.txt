# ğŸš€ Guide Complet NiFi pour DÃ©butants
## Pipeline de Validation des Tweets

---

## ğŸ“‹ Table des MatiÃ¨res
1. [AccÃ¨s Ã  NiFi](#1-accÃ¨s-Ã -nifi)
2. [Interface NiFi](#2-comprendre-linterface)
3. [CrÃ©ation du Flow](#3-crÃ©ation-du-flow)
4. [Configuration des Processeurs](#4-configuration-dÃ©taillÃ©e)
5. [Connexions](#5-crÃ©er-les-connexions)
6. [DÃ©marrage](#6-dÃ©marrer-le-flow)
7. [Surveillance](#7-surveiller-le-flow)

---

## 1. AccÃ¨s Ã  NiFi

### Ã‰tape 1.1 : DÃ©marrer Docker
```bash
docker-compose up -d
```

### Ã‰tape 1.2 : Ouvrir NiFi
1. Ouvrez votre navigateur
2. Allez sur : `http://localhost:8089/nifi`
3. Attendez 1-2 minutes que NiFi dÃ©marre

### Ã‰tape 1.3 : Se Connecter
- **Username** : `admin`
- **Password** : `adminadminadmin`
- Cliquez sur **Log In**

---

## 2. Comprendre l'Interface

### Ã‰lÃ©ments de l'Interface
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â‰¡] Menu    [â—‹] Operate  [âš™] Settings     â”‚  â† Barre supÃ©rieure
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“‹ â–¶ â¸ â¹ ğŸ”§ ğŸ“Š                            â”‚  â† Barre d'outils
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚                                              â”‚
â”‚            CANVAS (Zone de Travail)          â”‚  â† Glissez les processeurs ici
â”‚                                              â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Barre d'Outils (de gauche Ã  droite)
- **ğŸ“‹ Processor** : Ajouter un processeur
- **â–¶ Input Port** : Port d'entrÃ©e
- **â¸ Output Port** : Port de sortie
- **ğŸ”§ Process Group** : Groupe de processeurs
- **ğŸ“Š Funnel** : Entonnoir
- **Template** : ModÃ¨le
- **Label** : Ã‰tiquette

---

## 3. CrÃ©ation du Flow

### Vue d'Ensemble du Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ConsumeKafka â”‚â”€â”€â”€â–¶â”‚EvaluateJson  â”‚â”€â”€â”€â–¶â”‚RouteOn       â”‚
â”‚ (raw-tweets) â”‚    â”‚Path          â”‚    â”‚Attribute     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â–¼                                 â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚UpdateAttribute â”‚              â”‚LogAttribute     â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚(Invalid Tweets) â”‚
                              â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ PublishKafka   â”‚
                     â”‚(tweets-valid.) â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Configuration DÃ©taillÃ©e

### PROCESSEUR 1 : ConsumeKafka_2_6

#### Ã‰tape 1 : Ajouter le Processeur
1. Dans la barre d'outils, cliquez sur l'icÃ´ne **Processor** (ğŸ“‹)
2. Glissez-la sur le canvas (zone blanche)
3. Une fenÃªtre "Add Processor" s'ouvre
4. Dans la barre de recherche, tapez : `ConsumeKafka`
5. SÃ©lectionnez : **ConsumeKafka_2_6**
6. Cliquez sur **ADD**

#### Ã‰tape 2 : Configurer le Processeur
1. **Double-cliquez** sur le processeur (ou clic droit â†’ Configure)
2. Allez dans l'onglet **SETTINGS**
   - **Name** : `ConsumeKafka - Raw Tweets`
   
3. Allez dans l'onglet **PROPERTIES**
   - Faites dÃ©filer et trouvez ces propriÃ©tÃ©s :

| PropriÃ©tÃ© | Valeur | Comment trouver |
|-----------|--------|-----------------|
| **Kafka Brokers** | `kafka:9092` | Cherchez "Kafka Brokers" dans la liste |
| **Topic Name(s)** | `raw-tweets` | Cherchez "Topic Name" |
| **Topic Name Format** | `names` | Menu dÃ©roulant - sÃ©lectionnez "names" |
| **Group ID** | `nifi-validator-group` | Cherchez "Group ID" |
| **Offset Reset** | `latest` | Menu dÃ©roulant - sÃ©lectionnez "latest" |

4. Cliquez sur **APPLY**

---

### PROCESSEUR 2 : EvaluateJsonPath

#### Ã‰tape 1 : Ajouter le Processeur
1. Cliquez sur **Processor** (ğŸ“‹) dans la barre d'outils
2. Glissez sur le canvas (Ã  droite du premier processeur)
3. Tapez : `EvaluateJsonPath`
4. SÃ©lectionnez : **EvaluateJsonPath**
5. Cliquez sur **ADD**

#### Ã‰tape 2 : Configurer
1. **Double-cliquez** sur le processeur
2. Onglet **SETTINGS** :
   - **Name** : `EvaluateJsonPath - Extract Fields`
   - **Automatically Terminate Relationships** :
     - â˜‘ï¸ Cochez **failure**
     - â˜‘ï¸ Cochez **unmatched**

3. Onglet **PROPERTIES** :

| PropriÃ©tÃ© | Valeur | Explication |
|-----------|--------|-------------|
| **Destination** | `flowfile-attribute` | Menu dÃ©roulant |
| **Return Type** | `auto-detect` | Menu dÃ©roulant |
| **Path Not Found Behavior** | `ignore` | Menu dÃ©roulant |

4. **Ajouter des propriÃ©tÃ©s personnalisÃ©es** (IMPORTANT !) :
   - En haut Ã  droite des propriÃ©tÃ©s, cliquez sur **+** (bouton plus)
   - Ajoutez ces 4 propriÃ©tÃ©s UNE PAR UNE :

   **PropriÃ©tÃ© 1 :**
   - Property Name : `tweet.text`
   - Value : `$.text`
   - Cliquez **OK**

   **PropriÃ©tÃ© 2 :**
   - Property Name : `tweet.user`
   - Value : `$.user`
   - Cliquez **OK**

   **PropriÃ©tÃ© 3 :**
   - Property Name : `tweet.timestamp`
   - Value : `$.timestamp`
   - Cliquez **OK**

   **PropriÃ©tÃ© 4 :**
   - Property Name : `tweet.location`
   - Value : `$.location`
   - Cliquez **OK**

5. Cliquez sur **APPLY**

---

### PROCESSEUR 3 : RouteOnAttribute

#### Ã‰tape 1 : Ajouter le Processeur
1. Ajoutez un nouveau **Processor** (ğŸ“‹)
2. Tapez : `RouteOnAttribute`
3. SÃ©lectionnez : **RouteOnAttribute**
4. Cliquez sur **ADD**

#### Ã‰tape 2 : Configurer
1. **Double-cliquez** sur le processeur
2. Onglet **SETTINGS** :
   - **Name** : `RouteOnAttribute - Validate`

3. Onglet **PROPERTIES** :

| PropriÃ©tÃ© | Valeur |
|-----------|--------|
| **Routing Strategy** | `Route to Property name` |

4. **Ajouter une rÃ¨gle de validation** :
   - Cliquez sur **+** (en haut Ã  droite)
   - Property Name : `valid`
   - Value : `${tweet.text:isEmpty():not():and(${tweet.user:isEmpty():not()})}`
   - Cliquez **OK**

   > ğŸ’¡ **Explication** : Cette expression vÃ©rifie que `tweet.text` ET `tweet.user` ne sont PAS vides

5. Cliquez sur **APPLY**

---

### PROCESSEUR 4 : UpdateAttribute

#### Ã‰tape 1 : Ajouter le Processeur
1. Ajoutez un nouveau **Processor** (ğŸ“‹)
2. Tapez : `UpdateAttribute`
3. SÃ©lectionnez : **UpdateAttribute**
4. Cliquez sur **ADD**

#### Ã‰tape 2 : Configurer
1. **Double-cliquez** sur le processeur
2. Onglet **SETTINGS** :
   - **Name** : `UpdateAttribute - Add Metadata`

3. Onglet **PROPERTIES** :
   - Cliquez sur **+** pour ajouter 2 propriÃ©tÃ©s :

   **PropriÃ©tÃ© 1 :**
   - Property Name : `validated`
   - Value : `true`
   - Cliquez **OK**

   **PropriÃ©tÃ© 2 :**
   - Property Name : `validation.time`
   - Value : `${now():format('yyyy-MM-dd HH:mm:ss')}`
   - Cliquez **OK**

4. Cliquez sur **APPLY**

---

### PROCESSEUR 5 : PublishKafka_2_6

#### Ã‰tape 1 : Ajouter le Processeur
1. Ajoutez un nouveau **Processor** (ğŸ“‹)
2. Tapez : `PublishKafka`
3. SÃ©lectionnez : **PublishKafka_2_6**
4. Cliquez sur **ADD**

#### Ã‰tape 2 : Configurer
1. **Double-cliquez** sur le processeur
2. Onglet **SETTINGS** :
   - **Name** : `PublishKafka - Validated Tweets`
   - **Automatically Terminate Relationships** :
     - â˜‘ï¸ Cochez **success**
     - â˜‘ï¸ Cochez **failure**

3. Onglet **PROPERTIES** :

| PropriÃ©tÃ© | Valeur |
|-----------|--------|
| **Kafka Brokers** | `kafka:9092` |
| **Topic Name** | `tweets-validated` |
| **Delivery Guarantee** | `Best Effort` |

4. Cliquez sur **APPLY**

---

### PROCESSEUR 6 : LogAttribute

#### Ã‰tape 1 : Ajouter le Processeur
1. Ajoutez un nouveau **Processor** (ğŸ“‹)
2. Tapez : `LogAttribute`
3. SÃ©lectionnez : **LogAttribute**
4. Cliquez sur **ADD**
5. Placez-le en bas, sous RouteOnAttribute

#### Ã‰tape 2 : Configurer
1. **Double-cliquez** sur le processeur
2. Onglet **SETTINGS** :
   - **Name** : `LogAttribute - Invalid Tweets`
   - **Automatically Terminate Relationships** :
     - â˜‘ï¸ Cochez **success**

3. Onglet **PROPERTIES** :

| PropriÃ©tÃ© | Valeur |
|-----------|--------|
| **Log Level** | `warn` |
| **Log Payload** | `true` |
| **Log prefix** | `INVALID TWEET:` |

4. Cliquez sur **APPLY**

---

## 5. CrÃ©er les Connexions

### Qu'est-ce qu'une Connexion ?
Les connexions relient les processeurs entre eux pour faire circuler les donnÃ©es.

### Comment CrÃ©er une Connexion

#### Connexion 1 : ConsumeKafka â†’ EvaluateJsonPath
1. **Survolez** le processeur **ConsumeKafka**
2. Une **flÃ¨che** apparaÃ®t au centre du processeur
3. **Cliquez et maintenez** sur cette flÃ¨che
4. **Glissez** jusqu'au processeur **EvaluateJsonPath**
5. **RelÃ¢chez**
6. Une fenÃªtre "Create Connection" s'ouvre
7. Dans **For Relationships** :
   - â˜‘ï¸ Cochez **success**
8. Cliquez sur **ADD**

#### Connexion 2 : EvaluateJsonPath â†’ RouteOnAttribute
1. Survolez **EvaluateJsonPath**
2. Cliquez et glissez la flÃ¨che vers **RouteOnAttribute**
3. Dans **For Relationships** :
   - â˜‘ï¸ Cochez **matched**
4. Cliquez sur **ADD**

#### Connexion 3 : RouteOnAttribute â†’ UpdateAttribute
1. Survolez **RouteOnAttribute**
2. Cliquez et glissez vers **UpdateAttribute**
3. Dans **For Relationships** :
   - â˜‘ï¸ Cochez **valid**
4. Cliquez sur **ADD**

#### Connexion 4 : UpdateAttribute â†’ PublishKafka
1. Survolez **UpdateAttribute**
2. Cliquez et glissez vers **PublishKafka**
3. Dans **For Relationships** :
   - â˜‘ï¸ Cochez **success**
4. Cliquez sur **ADD**

#### Connexion 5 : RouteOnAttribute â†’ LogAttribute
1. Survolez **RouteOnAttribute**
2. Cliquez et glissez vers **LogAttribute** (en bas)
3. Dans **For Relationships** :
   - â˜‘ï¸ Cochez **unmatched**
4. Cliquez sur **ADD**

---

## 6. DÃ©marrer le Flow

### MÃ©thode 1 : DÃ©marrer Tous les Processeurs

#### Ã‰tape 1 : SÃ©lectionner Tout
1. Cliquez n'importe oÃ¹ sur le canvas (zone blanche)
2. Appuyez sur **Ctrl+A** (Windows/Linux) ou **Cmd+A** (Mac)
3. Tous les processeurs sont maintenant sÃ©lectionnÃ©s (contour bleu)

#### Ã‰tape 2 : DÃ©marrer
1. **Clic droit** sur n'importe quel processeur sÃ©lectionnÃ©
2. Dans le menu, sÃ©lectionnez **Start**
3. Tous les processeurs dÃ©marrent ! âœ…

### MÃ©thode 2 : DÃ©marrer Individuellement
1. **Clic droit** sur un processeur
2. SÃ©lectionnez **Start**
3. RÃ©pÃ©tez pour chaque processeur

### Comment Savoir si Ã§a Marche ?
- **IcÃ´ne verte** â–¶ = Processeur en cours d'exÃ©cution
- **IcÃ´ne rouge** â¹ = Processeur arrÃªtÃ©
- **Chiffres sur les connexions** = Nombre de FlowFiles en attente

---

## 7. Surveiller le Flow

### Voir les Statistiques

#### Sur un Processeur
1. **Clic droit** sur n'importe quel processeur
2. SÃ©lectionnez **View status history**
3. Vous verrez :
   - Nombre de FlowFiles traitÃ©s
   - Bytes lus/Ã©crits
   - Temps de traitement

#### Sur une Connexion
1. **Clic droit** sur une connexion (flÃ¨che)
2. SÃ©lectionnez **List queue**
3. Vous verrez les FlowFiles en attente

### Voir les Logs

#### Logs d'un Processeur
1. **Clic droit** sur un processeur
2. SÃ©lectionnez **View Data Provenance**
3. Vous verrez l'historique des donnÃ©es

#### Logs NiFi GÃ©nÃ©raux
```bash
# Dans votre terminal
docker logs nifi
```

### VÃ©rifier les Tweets Invalides
Les tweets invalides sont loggÃ©s par **LogAttribute** :
```bash
docker logs nifi | grep "INVALID TWEET"
```

---

## 8. ArrÃªter le Flow

### ArrÃªter Tous les Processeurs
1. **Ctrl+A** pour tout sÃ©lectionner
2. **Clic droit** â†’ **Stop**
3. Attendez que tous les processeurs s'arrÃªtent (icÃ´ne rouge â¹)

---

## 9. DÃ©pannage

### ProblÃ¨me : Processeur en Erreur (âš ï¸)
1. **Clic droit** sur le processeur
2. SÃ©lectionnez **View configuration**
3. Regardez l'onglet **Settings** â†’ **Bulletin** pour voir l'erreur

### ProblÃ¨me : Pas de DonnÃ©es
1. VÃ©rifiez que Kafka fonctionne :
   ```bash
   docker ps | grep kafka
   ```
2. VÃ©rifiez que le topic existe :
   ```bash
   docker exec -it kafka kafka-topics --list --bootstrap-server localhost:9092
   ```

### ProblÃ¨me : Connexion Invalide (âš ï¸ triangle orange)
1. **Clic droit** sur la connexion
2. VÃ©rifiez les relationships sÃ©lectionnÃ©es
3. Assurez-vous que la destination peut recevoir ces relationships

---

## 10. Bonnes Pratiques

### Organiser le Canvas
- Alignez les processeurs horizontalement
- Espacez-les de 300-400 pixels
- Utilisez des **Labels** pour documenter

### Nommer les Processeurs
- Utilisez des noms descriptifs
- Format : `Action - Description`
- Exemple : `ConsumeKafka - Raw Tweets`

### Terminer les Relationships
- Toujours terminer les relationships inutilisÃ©es
- Cochez "Auto Terminate Relationships" dans Settings
- Ã‰vite les avertissements âš ï¸

---

## 11. Commandes Utiles

### Sauvegarder le Flow
1. **Clic droit** sur le canvas (zone vide)
2. **Create template**
3. Donnez un nom : `Tweet Validation Flow`
4. Cliquez **Create**

### Exporter le Template
1. Menu hamburger â˜° (en haut Ã  droite)
2. **Templates**
3. Trouvez votre template
4. Cliquez sur l'icÃ´ne **Download** ğŸ’¾

### Importer un Template
1. Menu hamburger â˜°
2. **Templates** â†’ **Upload template**
3. SÃ©lectionnez le fichier XML
4. Glissez l'icÃ´ne **Template** sur le canvas pour l'utiliser

---

## 12. RÃ©sumÃ© des Configurations

### RÃ©capitulatif Complet

```
PROCESSEUR 1: ConsumeKafka_2_6
â”œâ”€â”€ Kafka Brokers: kafka:9092
â”œâ”€â”€ Topic Name(s): raw-tweets
â”œâ”€â”€ Topic Name Format: names
â”œâ”€â”€ Group ID: nifi-validator-group
â””â”€â”€ Offset Reset: latest

PROCESSEUR 2: EvaluateJsonPath
â”œâ”€â”€ Destination: flowfile-attribute
â”œâ”€â”€ tweet.text: $.text
â”œâ”€â”€ tweet.user: $.user
â”œâ”€â”€ tweet.timestamp: $.timestamp
â””â”€â”€ tweet.location: $.location

PROCESSEUR 3: RouteOnAttribute
â”œâ”€â”€ Routing Strategy: Route to Property name
â””â”€â”€ valid: ${tweet.text:isEmpty():not():and(${tweet.user:isEmpty():not()})}

PROCESSEUR 4: UpdateAttribute
â”œâ”€â”€ validated: true
â””â”€â”€ validation.time: ${now():format('yyyy-MM-dd HH:mm:ss')}

PROCESSEUR 5: PublishKafka_2_6
â”œâ”€â”€ Kafka Brokers: kafka:9092
â”œâ”€â”€ Topic Name: tweets-validated
â””â”€â”€ Delivery Guarantee: Best Effort

PROCESSEUR 6: LogAttribute
â”œâ”€â”€ Log Level: warn
â”œâ”€â”€ Log Payload: true
â””â”€â”€ Log prefix: INVALID TWEET:
```

---

## ğŸ‰ FÃ©licitations !

Vous avez crÃ©Ã© votre premier flow NiFi de validation de tweets !

### Prochaines Ã‰tapes
- Testez en envoyant des tweets Ã  Kafka
- Surveillez les statistiques
- Explorez d'autres processeurs NiFi
- CrÃ©ez des flows plus complexes

### Ressources
- [Documentation NiFi](https://nifi.apache.org/docs.html)
- [Expression Language Guide](https://nifi.apache.org/docs/nifi-docs/html/expression-language-guide.html)
- [Processeurs NiFi](https://nifi.apache.org/docs/nifi-docs/components/org.apache.nifi/nifi-standard-nar/1.23.2/)

---

**Besoin d'aide ?** VÃ©rifiez les logs avec `docker logs nifi` !



âœ… 1. Erreurs dans PublishKafka_2_6

Tu as trois erreurs :

ğŸ”´ ERREUR 1 : Delivery Guarantee est invalide

Message :

'Delivery Guarantee' is invalid because In order to use Transactions, the Delivery
Guarantee must be "Guarantee Replicated Delivery."

Cela signifie que :

Use Transactions = true

Mais Delivery Guarantee = Best Effort

ğŸ‘‰ Cette configuration est interdite.

âœ… Solution

Ouvre PublishKafka_2_6 â†’ PROPERTIES :

â¡ï¸ Mets :

Delivery Guarantee : Guarantee Replicated Delivery
OU

Use Transactions : false

ğŸ‘‰ Je te conseille de mettre :
Delivery Guarantee = Best Effort
Use Transactions = false

Parce que tu n'as pas besoin des transactions.

ğŸ”´ ERREUR 2 : Relationship success n'est pas connectÃ© et pas auto-terminÃ©

Message :

'Relationship success' is invalid because Relationship 'success' is not connected to any component and is not auto-terminated

Cela signifie que tu nâ€™as crÃ©Ã© aucune connexion Ã  partir de PublishKafka.

MÃªme si tu coches auto terminate, tu dois le faire dans Settings, pas dans la connexion.

âœ… Solution

Ouvre PublishKafka â†’ Settings :

âœ”ï¸ Coche :

Automatically terminate relationship â†’ success

Automatically terminate relationship â†’ failure

Ensuite clique Apply.

ğŸš¨ 2. Erreur dans LogAttribute

Message :

'Relationship success' is invalid because Relationship 'success' is not connected to any component and is not auto-terminated

Câ€™est la mÃªme erreur : tu n'as aucune connexion qui part de LogAttribute.

Comme ce processeur est juste pour log, il ne doit rien envoyer ailleurs.

âœ… Solution

Ouvre LogAttribute â†’ Settings :

âœ”ï¸ Coche :

Automatically terminate relationship â†’ success

Clique Apply.